# 增加项目列表与详情页功能计划

## 1. 架构设计 (Leijun)

将调用 `leijun` 智能体进行以下设计确认：

* **项目列表 API**: 设计 `GET /v1/projects` 接口。

  * **鉴权**: 必须使用 `X-User-Id` 头过滤用户数据 (遵循 `dev_rules_auth.md`)。

  * **分页**: 确认是否需要分页 (MVP 可能暂时不需要，但最好预留)。

  * **响应字段**: 确认返回 `id`, `title`, `status`, `createdAt`, `houseInfo` (简略)。

* **重试机制**:

  * 确认 "视频创建失败" 的重试逻辑。通常是重新触发 `renderVideo` (`POST /v1/projects/{id}/render`)，或者如果是脚本生成失败，则重试 `generateScript`。

  * 确认前端如何根据状态 (`FAILED`) 展示重试按钮。&#x20;

* **脚本再编辑**:

  * 确认 `PUT /v1/projects/{id}/script` 是否足以支持 "重新编辑脚本" 需求。

## 2. 后端实现 (Backend)

基于设计，我将直接修改 Java 代码：

* **ProjectController**: 新增 `listProjects` 端点。

* **ProjectService**: 实现 `listProjects` 逻辑 (Repository查询)。

* **ProjectRepository**: 确保有 `findAllByUserId` 方法。

## 3. 前端实现 (UIPro)

将调用 `uipro` 智能体进行页面开发：

* **API 层**: 更新 `src/api/project.ts` 增加 `list()` 方法。

* **路由**: 在 `src/router/index.ts` 增加 `/projects` (列表) 和 `/projects/:id` (详情)。

* **页面开发**:

  * `ProjectList.vue`: 使用 Vant 组件 (`van-list`, `van-cell`) 展示项目。

  * `ProjectDetail.vue`:

    * 展示基础信息。

    * **脚本编辑**: 提供文本域编辑 `scriptContent` 并调用 `updateScript`。

    * **失败重试**: 若状态为失败，提供按钮调用 `renderVideo` (或对应重试接口)。

